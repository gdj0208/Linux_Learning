
# íŒŒì´í”„

## 1ï¸âƒ£ íŒŒì´í”„

### ğŸ¯ íŒŒì´í”„ë€?
- ë‘ í”„ë¡œì„¸ìŠ¤ ì‚¬ì´ì—ì„œ í•œ ë°©í–¥ìœ¼ë¡œ í†µì‹ í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” ê²ƒ
- Shellì—ì„œ `|` ê°€ íŒŒì´í”„ë¥¼ ì˜ë¯¸
```shell
$ cat test.c | more
```
- cat test.cì˜ í‘œì¤€ ì¶œë ¥ì„ ë‹¤ìŒ ëª…ë ¹ì¸ moreì˜ í‘œì¤€ ì…ë ¥ìœ¼ë¡œ ì‚¬ìš©

(18)
- write()ì‹œ íŒŒì´í”„ì— ì¶©ë¶„í•œ ê³µê°„ì´ ìˆìœ¼ë©´ íŒŒì´í”„ ì €ì¥
1. ì“°ê¸° ì „ìš© íŒŒì¼ ê¸°ìˆ ìë¥¼ ë‹«ì€ ê²½ìš° :
2. ì½ê¸° ì €ë‡½ íŒŒì¼ ê¸°ìˆ ìë¥¼ ë‹«ì€ ê²½ìš° : 
    - ìë£Œ ì½ê¸°ë¥¼ ìœ„í•´ í•´ë‹¹ íŒŒì´í”„ë¥¼ ê°œë°©í–” íƒ€ í”„ë¡œì„¸ìŠ¤ ì¡´ì¬ : Ok
    - SIGPIPE ì‹œê·¸ë„ (ì˜¤ë¥˜)



### ğŸ¯ ì´ë¦„ ì—†ëŠ” íŒŒì´í”„ : pipe
```c
FILE *popen(const char *command, const char *type); // ê³ ìˆ˜ì¤€ ì‹œìŠ¤í…œì½œ
int pclose(FILE *stream);   // ì €ìˆ˜ì¤€ ì‹œìŠ¤í…œ ì½œ

int pipe(int pipefd[2]);
```
- ë¶€ëª¨-ìì‹ í”„ë¡œì„¸ìŠ¤ê°„ í†µì‹ 
- ë‹¨ ë°©í–¥ í†µì‹  : 'ë¶€ëª¨->ìì‹' ë˜ëŠ” 'ìì‹->ë¶€ëª¨' í•œ ë°©í–¥ìœ¼ë¡œë§Œ í†µì‹ 



### ğŸ¯ ì´ë¦„ ìˆëŠ” íŒŒì´í”„ : FIFO
```c
int mknod(const char *pathname, mode_t mode, dev_t dev);
int mkfifo(const char *pathname, mode_t mode);
```
- ë¶€ëª¨-ìì‹ í”„ë¡œì„¸ìŠ¤ ê´€ê³„ê°€ ì•„ë‹Œ ë…ë¦½ì ì¸ í”„ë¡œì„¸ìŠ¤ë“¤ì˜ íŒŒì´í”„ ì‚¬ìš© ê°€ëŠ¥






## 2ï¸âƒ£ ì´ë¦„ ì—†ëŠ” íŒŒì´í”„

### ğŸ¯ íŒŒì´í”„ ë§Œë“¤ê¸° : popen()

**[ ì½”ë“œ ]**
```c
FILE *popen(const char *command, const char *type);
```
- command : ì…¸ ëª…ë ¹
- type : "r", "w"

**[ íŠ¹ì§• ]**
- ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì™€ í†µì‹ í•˜ê¸° ìœ„í•œ íŒŒì´í”„ ì„¤ì •
- ë‚´ë¶€ì ìœ¼ë¡œ fork()ë¥¼ ì‹¤í–‰í•˜ì—¬ ìì‹ í”„ë¡œì„¸ìŠ¤ í˜•ì„± -> ìì‹ í”„ë¡œì„¸ìŠ¤ commandì— exec() ì‹¤í–‰

**[ ì˜ˆì œ ]**
```c
// ex_2.c

#include <stdlib.h>
#include <stdio.h>

int main( ) {
    FILE *fp;
    char buf[256];

    fp = popen("date", "r");
    if (fp == NULL) {
       fprintf(stderr, "popen failed\n");
       exit(1);
    }

    if (fgets(buf, sizeof(buf), fp) == NULL) {
        fprintf(stderr, "No data from pipe!\n");
        exit(1);
    }

    printf("line : %s\n", buf);
    pclose(fp);
}

// ì‹¤í–‰ ê²°ê³¼ : 
// line : 2025. 10. 29. (ìˆ˜) 21:23:19 KST
```



### ğŸ¯ íŒŒì´í”„ ë‹«ê¸° : pclose()

**[ ì½”ë“œ ]**
```c
int pclose(FILE *stream);
```

**[ íŠ¹ì§• ]**
- íŒŒì¼ ì…ì¶œë ¥ í•¨ìˆ˜ì²˜ëŸ¼ ì¸ìë¡œ ì§€ì •í•œ íŒŒì´í”„ë¥¼ ë‹«ìŒ
- ê´€ë ¨ëœ waitpid() ìˆ˜í–‰ -> ìì‹ í”„ë¡œì„¸ìŠ¤ë“¤ì´ ì¢…ë£Œí•˜ê¸¸ ê¸°ë‹¤ë ¸ë‹¤ê°€ ë¦¬í„´

**[ ì˜ˆì œ ]**
```c
// ex_1.c

#include <stdlib.h>
#include <stdio.h>

int main( ) {
    FILE *fp;
    int a;

    fp = popen("wc -l", "w");
    if (fp == NULL) {
        fprintf(stderr, "popen failed\n");
        exit(1);
    }

    for (a = 0; a < 100; a++)
        fprintf(fp, "test line\n");

    pclose(fp);
}

// ì‹¤í–‰ ê²°ê³¼ : 100
```



### ğŸ¯ íŒŒì´í”„ ë§Œë“¤ê¸° : pipe()

**[ ì„¤ëª… ]**
```c
int pipe(int pipefid[2]);
```
- pipefd[2] : íŒŒì´í”„ë¡œ ì‚¬ìš©í•  íŒŒì¼ ê¸°ìˆ ì (2ê°œ)
    - pipefd[0] : ì½ê¸° ì „ìš©
    - pipefd[1] : ì“°ê¸° ì „ìš©

**[ íŠ¹ì§• ]**
- íŒŒì¼ê¸°ìˆ ì 2ê°œë¥¼ ë°›ì•„ ì €ì¥

**[ pipe í†µì‹  ê³¼ì • ]**
1. pipe()ë¥¼ í˜¸ì¶œí•´ íŒŒì´í”„ì— ì‚¬ìš©í•  íŒŒì¼ ê¸°ìˆ ìë¥¼ ì–»ìŒ
![alt text](image.png)

    ```c
    //ex_3.c

    #include <unistd.h>
    #include <stdio.h>
    #include <stdlib.h>

    #define MSGSIZE		16

    char *msg1 = "hello, world #1";
    char *msg2 = "hello, world #2";
    char *msg3 = "hello, world #3";

    main() {

        char inbuf[MSGSIZE];
        int p[2], j;

        if (pipe(p) == -1) { perror("pipe call"); exit(1); }

        write(p[1], msg1, MSGSIZE);
        write(p[1], msg2, MSGSIZE);
        write(p[1], msg3, MSGSIZE);

        for (j=0; j<3; j++) { 
            read(p[0], inbuf, MSGSIZE);
            printf("%s\n", inbuf);
        }

        exit(0);
    }
    ```
    - ìœ„ ì½”ë“œì—ì„œëŠ” p[1]ì˜ writeë¥¼ íŒŒì´í”„ë¥¼ í†µí•´ p[0]ê°€ ì½ê³  ì°¨í›„ p[0]ì—ì„œ ë¬¸ìì—´ì„ ì¶œë ¥

2. fork() í•¨ìˆ˜ë¥¼ ìˆ˜í–‰í•´ ì§€ì‹ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„± 
![alt text](image-1.png)

    ```c
    #include <unistd.h>
    #include <stdio.h>
    #include <stdlib.h>

    #define MSGSIZE		16

    char *msg1 = "hello, world #1";
    char *msg2 = "hello, world #2";
    char *msg3 = "hello, world #3";

    main() {

        char inbuf[MSGSIZE];
        int p[2], j;
        pid_t pid;

        if (pipe(p) == -1) { perror("pipe call"); exit(1); }

        switch (pid = fork()) {
        case -1:
            perror("fork call");
            exit(2);
        case 0:
            write(p[1], msg1, MSGSIZE);
            write(p[1], msg2, MSGSIZE);
            write(p[1], msg3, MSGSIZE);
            break;
        default:
            for (j=0; j<3; j++) {
                read(p[0], inbuf, MSGSIZE);
                printf("%s\n", inbuf);
            }
            wait(NULL);
        }

        exit(0);
    }
    ```
    - ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤ ë‚´ p[0], p[1] ë³´ìœ 
    - ìì‹ í”„ë¡œì„¸ìŠ¤ ë‚´ p[0], p[1] ë³´ìœ 
    - íŒŒì´í”„ë¥¼ í†µí•´ ë¶€ëª¨ p[1]->ìì‹ p[0], ìì‹ p[1]->ë¶€ëª¨ p[0]

3. íŒŒì´í”„ëŠ” ë‹¨ë°©í–¥ í†µì‹ ì´ë¯€ë¡œ ë°©í–¥ì„ ê²°ì •


**[ pipe() ì˜ˆì‹œ ì½”ë“œë“¤ ]**
- pipe() í•¨ìˆ˜ë¡œ ëª…ë ¹ ì‹¤í–‰í•˜ê¸°
```c
#include <sys/wait.h>
#include <unistd.h>
#include <stdlib.h>
#include <stdio.h>

int main( ) {
    int fd[2];
    pid_t pid;
    char buf[257];
    int len, status;

    if (pipe(fd) == -1) {
        perror("pipe");
        exit(1);
    }

    switch (pid = fork( )) {
    case -1 :
        perror("fork");
        exit(1);
        break;
    case 0 : /* child */
        close(fd[1]);
        write(1, "Child Process:", 15);
        len = read(fd[0], buf, 256);
        write(1, buf, len);
        close(fd[0]);
        break;
    default :
        close(fd[0]);
        write(fd[1], "Test Message\n", 14);
        close(fd[1]);
        waitpid(pid, &status, 0);
        break;
    }
}
```

- pipe() í•¨ìˆ˜ë¡œ ëª…ë ¹ ì‹¤í–‰í•˜ê¸°
```c
// ex_6.c

#include <sys/wait.h>
#include <unistd.h>
#include <stdlib.h>
#include <stdio.h>

int main(void) {
    int fd[2];
    pid_t pid;

    if (pipe(fd) == -1) {
        perror("pipe");
        exit(1);
    }

    switch (pid = fork()) {
        case -1 :
            perror("fork");
            exit(1);
            break;
        case 0 : /* child */
            close(fd[1]);
            if (fd[0] != 0) {
                dup2(fd[0], 0);
                close(fd[0]);
            }
            execlp("grep", "grep", "ssh", (char *)NULL);
            exit(1);
            break;
        default :
            close(fd[0]);
            if (fd[1] != 1) {
                dup2(fd[1], 1);
                close(fd[1]);
            }
            execlp("ps", "ps", "-ef", (char *)NULL);
            wait(NULL);
            break;
    }

    return 0;
}
```

- ì–‘ë°©í–¥ í†µì‹ í•˜ê¸°
```c
#include <sys/wait.h>
#include <unistd.h>
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

int main( ) {
    int fd1[2], fd2[2];
    pid_t pid;
    char buf[257];
    int len, status;

    if (pipe(fd1) == -1) {
        perror("pipe");
        exit(1);
    }

    if (pipe(fd2) == -1) {
        perror("pipe");
        exit(1);
    }

    switch (pid = fork( )) {
        case -1 :
            perror("fork");
            exit(1);
            break;
        case 0 : /* child */
            close(fd1[1]);
            close(fd2[0]);
            len = read(fd1[0], buf, 256);
            write(1, "Child Process:", 15);
            write(1, buf, len);

            strcpy(buf, "Good\n");
            write(fd2[1], buf, strlen(buf));
            break;
        default :
            close(fd1[0]);
            close(fd2[1]);
            write(fd1[1], "Hello\n", 6);

            len = read(fd2[0], buf, 256);
            write(1, "Parent Process:", 15);
            write(1, buf, len);
            waitpid(pid, &status, 0);
            break;
    }
}

/*
ì‹¤í–‰ ê²°ê³¼ : 
Child Process:Hello
Parent Process:Good
*/
```